define("lesson/js/asidebar",["lesson/js/common"],function(t){var e={},i={},n={};return e={init:function(){this.bindEvents(),this.properties(),$("#lessonLeft").on("click",function(){e()}),$("#lessonRight").on("click",function(){e()});var e=function(){$("#chapterlist").hasClass("active")&&$("#asidebar .js-chapter").click()},i=$("#note-scrollbar"),n=$("#qa-scrollbar");t.on("lesson.resize",function(){t.scrollbar.init(i),t.scrollbar.init(n)})},Api:{loadChapterlist:"/lesson/chapterlist"},properties:function(){this.$chapterlist=$("#chapterlist")},bindEvents:function(){var t=this;$("#asidebar").on("click",".js-chapter",function(){t.onChapters()}),$("#asidebar").on("click",".js-wenda",function(){t.onWendaList()}),$("#asidebar").on("click",".js-note",function(){t.onNoteList()})},onChapters:function(){var t=App.MEDIAINFO.id,e=this.$chapterlist.hasClass("active");e?this.$chapterlist.removeClass("active"):this.$chapterlist.addClass("active"),t!=this.$chapterlist.data("mid")&&(this.$chapterlist.data("mid",t),this.loadChapters())},loadChapters:function(){var t=this,e={};e.mid=$("#chapterlist").data("mid"),e.cid=OP_CONFIG.curCourse.id,$.post(t.Api.loadChapterlist,e,function(e){0==e.result?t.RendeChapters(e.data):$.alert(e.msg)},"json")},RendeChapters:function(e){if(e.length>0){var i=$("#chapter-tpl").html(),n="",a=1;2==OP_CONFIG.later&&(a=2),n=juicer(i,{data:e,later:a})}else n="";if($("#chapterlist").removeClass("loading").find(".js-chapterlist").html(n),e.length>0){var s=$("#chapter-scrollbar");t.scrollbar.init(s,function(){var e=s.find(".cur"),i=e.parent(),n=0,a=s.height();n=i.position().top,n>a&&(s.scrollTop(n-i.height()),t.scrollbar.update(s))})}},onWendaList:function(){var e=App.MEDIAINFO.id,i=$("#qa-pannel");"visible"==i.css("visibility")?($("#lessonwrap").hasClass("renewal")&&$("#lessonDrag").hide(),t.Pannel.wenda.hide()):t.Pannel.wenda.show(),e!=i.data("mid")&&(i.data("mid",e),this.initList("wenda"))},onNoteList:function(){var e=this,i=App.MEDIAINFO.id,n=$("#note-pannel"),a="visible"==n.css("visibility");a?($("#lessonwrap").hasClass("renewal")&&$("#lessonDrag").hide(),t.Pannel.note.hide()):t.Pannel.note.show(),i!=n.data("mid")&&(n.data("mid",i),e.initList("note"))},initList:function(t){"wenda"==t?i.init():"note"==t&&n.init()},__scrollbar:function(e,i,n,a){if(t.scrollbar.init(i),null!=e&&1==e.data.page.page){var s=n.find(".pagination"),r={};e.data.page&&e.data.page.total>e.data.page.pageSize?(r=e.data.page,s.pagination(r.total,{prev_text:"上一页",next_text:"下一页",items_per_page:r.pageSize,num_display_entries:3,num_edge_entries:2,callback:function(t){a&&a(t)}})):s.html("")}else null==e?(n.find(".pagination").html(""),i.scrollTop(0),t.scrollbar.update(i)):(i.scrollTop(0),t.scrollbar.update(i))}},i={Api:{verifycode:"/course/verifycode?_t=addqa",loadList:"/lesson/ajaxqa",addqa:"/course/addqa"},properties:function(){this.$FormParent=$("#qaForm"),this.searchArea=$(".js-search-qa-area")},init:function(){var e=this;if(this.initN){var i=$("#qa-pannel");if(this.properties(),this.bindEvents(),1==OP_CONFIG.later){require(["ueditor"],function(){var t=UE.getEditor("editQuestionEditor",{initialFrameHeight:82,initialFrameWidth:"100%",autoFloatEnabled:!1,autoClearinitialContent:!0,initialStyle:"p{line-height:1.5em;font-size:13px;color:#444}"});e.editQuestionEditor=t,window.editQuestionEditor=t,t.addListener("focus",function(){e.searchArea.removeClass("curr")})});var n=t.RenderQrcodeTpl(this.Api.verifycode);i.find(".editstate-bt").prepend(n)}this.initN=!1}this.loadList()},initN:!0,loadList:function(t,e){var i=this;if(2==OP_CONFIG.later)var t=t||"myquestion";else var t=t||"all";var e=e||0,n={};n.mid=App.MEDIAINFO.id,n.page=e+1,n.t=t,$.post(i.Api.loadList,n,function(e){0==e.result?i.RendeList(e,t):$.alert(e.msg)},"json")},RendeList:function(t,i){var n=this,a=$("#wenda-tpl").html(),s="",r=$("#qa-scrollbar");t.data.list.length>0?(s=juicer(a,{data:{list:t.data.list,ulimit:OP_CONFIG.ulimit}}),$("#wendalist").html(s),e.__scrollbar(t,r,$("#qa-pannel"),function(t){n.loadList(i,t)})):(2==OP_CONFIG.later?s="myquestion"==i?'<p class="notdata">你还没有发布任何的提问</p>':'<div class="renewal-text">								<p>您的教学服务已到期，如需使用完整的问答功能请续费</p>								<a class="go-renewal" href="http://class.imooc.com/service/renewal?cid='+OP_CONFIG.curCourse.id+'&tid=1" target="_blank">马上续费</a>							</div>':"all"==i?s='<p class="notdata">暂无相关问答</p>':"pending"==i?s='<p class="notdata">暂无待解决问答</p>':"myquestion"==i?s='<p class="notdata">你还没有发布任何的提问</p>':"myanswer"==i&&(s='<p class="notdata">你还没有回复任何的提问</p>'),$("#wendalist").html(s),e.__scrollbar(null,r,$("#qa-pannel")))},bindEvents:function(){var t=this;this.$FormParent.on("click",".js-save",function(){t.addqa()}),$(".js-qanav").on("click","a",function(){var e=$(this),i=e.attr("data-type");e.siblings("a").removeClass("cur"),e.addClass("cur"),t.loadList(i)}),$("#qa-pannel").on("click",".js-close",function(){$("#asidebar .js-wenda").click()});var e=null;$("#qa-pannel").on("keyup focus",".qa-title",function(){clearTimeout(e);var i=this;e=setTimeout(function(){$.getJSON("/sc/ajaxrelatequestion",{cid:OP_CONFIG.curCourse.id,word:$(i).val()},function(e){0==e.result&&t.relatequestion(e.data)})},200)}),$("#qa-pannel").on("keydown",".qa-title",function(){clearTimeout(e)}),$(document).on("click",function(){t.searchArea.removeClass("curr")}),$("#qa-pannel").on("click",".qa-title",function(t){t.stopImmediatePropagation()}),this.searchArea.on("click",function(t){t.stopImmediatePropagation()})},relatequestion:function(t){if(t.length<0)return void $(document).trigger("click");for(var e="",i=0;i<t.length;i++)e+="<a title='"+t[i].title+"' target='_blank' href='/course/qadetail/"+t[i].id+"' class='clearfix'>",e+=t[i].finished>0?"<i class='imv2-check_c check_c'></i>":"<i class='imv2-help help'></i>",e+="<span class='search-qa-title'>"+t[i].title+"</span>",e+="<span class='search-qa-num'>"+t[i].answers+"个回答</span>",e+="</a>";this.searchArea.find(".search-qa-area-list").html(e),this.searchArea.addClass("curr")},showError:function(t,e){t.html(e)},hideError:function(){this.$FormParent.find(".qa-title").next(".error").html(""),$("#editQuestionEditor").next(".error").html(""),this.$FormParent.find(".verify-text").siblings(".errtip").html("")},addqa:function(){var t=this,e=t.$FormParent.find(".qa-title"),i=t.$FormParent.find(".verify-text");this.hideError();var n={};return n.mid=App.MEDIAINFO.id,n.title=e.val(),n.content=t.editQuestionEditor.getContent(),n.verify_code=i.val(),n.title.length<5?(this.showError(e.next(".error"),"标题不能小于5个字符"),!1):n.title.length>50?(this.showError(e.next(".error"),"标题不能多于50个字符"),!1):n.content.replace(/<\w+>|<\/\w+>|<\w+\/>|\s+|&nbsp;/g,"").length<5?(this.showError($("#editQuestionEditor").next(".error"),"内容不能少于5个字符"),!1):n.content.replace(/<\w+>|<\/\w+>|<\w+\/>|\s+|&nbsp;/g,"").length>8e3?(this.showError($("#editQuestionEditor").next(".error"),"内容不能多于8000个字符"),!1):n.verify_code.length<4?(this.showError(i.siblings(".errtip"),"验证码错误"),!1):void $.post(t.Api.addqa,n,function(e){0==e.result?($(".js-qanav a")[0].click(),$.tipAlert(t.$FormParent.find(".js-save"),{icon:"success",info:"问题添加成功！",timeout:3e3}),t.$FormParent.find(".qa-title").val(""),t.$FormParent.find(".verify-text").val(""),t.editQuestionEditor.setContent(""),t.$FormParent.find(".js-imv2-refresh").click()):-103002==e.result?(t.showError(i.siblings(".errtip"),"验证码错误"),t.$FormParent.find(".js-imv2-refresh").click()):$.alert(e.msg)},"json")},refreshList:function(){this.loadList()}},n={Api:{verifycode:"/course/verifycode?_t=addnote",loadList:"/lesson/ajaxnote",addnote:"/course/addnote"},init:function(){if(this.initN){var e=$("#note-pannel");if(this.bindEvents(),1==OP_CONFIG.later){var i=t.RenderQrcodeTpl(this.Api.verifycode);e.find(".Qrcode-wrap").html(i)}this.initN=!1}this.loadList()},initN:!0,loadList:function(t,e){var i=this;if(2==OP_CONFIG.later)var t=t||"my";else var t=t||"all";var e=e||0,n={};n.mid=OP_CONFIG.mid,n.page=e+1,n.t=t,$.post(i.Api.loadList,n,function(e){0==e.result?i.RendeList(e,t):$.alert(e.msg)},"json")},RendeList:function(t,i){var n=this,a={},s=$("#note-scrollbar"),r=$("#note-tpl").html(),o="";a.list=t.data.list,a.uid=OP_CONFIG.userInfo.uid,a.t=t.data.t,a.list.length>0?(o=juicer(r,{data:a}),$("#notelist").html(o),e.__scrollbar(t,s,$("#note-pannel"),function(t){n.loadList(i,t)})):(o=2==OP_CONFIG.later?"my"==i?'<p class="notdata">暂无相关笔记</p>':'<div class="renewal-text">								<p>您的教学服务已到期，如需使用完整的笔记功能请续费</p>								<a class="go-renewal" href="http://class.imooc.com/service/renewal?cid='+OP_CONFIG.curCourse.id+'&tid=1" target="_blank">马上续费</a>							</div>':'<p class="notdata">暂无相关笔记</p>',$("#notelist").html(o),e.__scrollbar(null,s,$("#note-pannel")))},$noteWrap:$("#note-pannel"),$FormParent:$("#noteForm"),$listParent:$("#notelist"),bindEvents:function(){var t=this;$(".js-notenav").on("click","a",function(){var e=$(this),i=e.attr("data-type");e.siblings("a").removeClass("cur"),e.addClass("cur"),t.loadList(i)}),t.$FormParent.on("click",".js-save",function(){t.save($(this))}),t.$listParent.on("click",".js-edit",function(){t.editShow($(this))}),t.$listParent.on("click",".js-cancel",function(){t.editHide($(this))}),t.$listParent.on("click",".js-save",function(){t.revised($(this))}),t.$listParent.on("click",".js-delete",function(){var e=$(this);$.confirm("你确定要删除这条笔记吗？",{callback:function(){t.rmNote(e)}})}),t.$listParent.on("click",".js-favor",function(){t.favorNote($(this))}),t.$listParent.on("click",".js-collect",function(){t.collectNote($(this))}),t.$listParent.on("mousewheel",".edit-area",function(t){t.stopPropagation()}),t.$listParent.on("click",".js-answer-img-small",function(){var t=$(this),e=t.find("img"),i=e.data("small"),n=e.data("big"),a=$(".js-answer-img-small.expand");!t.is(".expand")&&a.length&&a.trigger("click"),"expand"==t.data("state")?(t.removeClass("expand").data("state","small"),e.attr("src",i)):(t.addClass("expand").data("state","expand"),e.attr("src",n))}),t.$noteWrap.on("click",".switch-wrap",function(){var t=$(this).find(".switch"),e=t.hasClass("on");e?t.removeClass("on"):t.addClass("on")}),$("#note-pannel").on("click",".js-close",function(){$("#asidebar .js-note").click()})},save:function(){var t=this,e=t.$FormParent.find("textarea"),i=t.$FormParent.find(".js-verify-box-wrap");e.next(".error").html(""),i.find(".errtip").html("");var n=e.val(),a={};return a.mid=OP_CONFIG.mid,a.share=t.$FormParent.find(".share").hasClass("on")?1:0,a.verify_code=t.$FormParent.find(".verify-text").val(),""==$.trim(n)?(e.next(".error").html("笔记内容不能为空！"),!1):$.trim(n).length>2e3?(e.next(".error").html("笔记内容不能多于2000个字符！"),!1):(a.content=n,"video"==App.MEDIAMODE&&t.$FormParent.find(".pic").hasClass("on")&&(a.pic_time=App.picTime()),"code"==App.MEDIAMODE&&t.$FormParent.find(".pic").hasClass("on")&&(a.files=App.getFiles),void $.post(t.Api.addnote,a,function(n){if(0==n.result){var a=$(".js-notenav").find(".cur").data("type");t.refreshList(a),$.tipAlert(t.$FormParent.find(".js-save"),{icon:"success",info:"笔记添加成功！",timeout:3e3}),e.val(""),t.$FormParent.find(".verify-text").val(""),e.next(".error").html(""),i.find(".errtip").html(""),i.find(".js-imv2-refresh").click()}else-103002==n.result||-4==n.result?(i.find(".errtip").html("验证码错误,请重新输入"),i.find(".js-imv2-refresh").click()):$.alert(n.msg)},"json"))},editShow:function(t){var e=t.parents(".note-item");e.addClass("edit")},editHide:function(t){var e=t.parents(".note-item"),i=e.find(".edit-area");e.removeClass("edit"),i.val($.trim(e.find(".content").html()))},revised:function(t){var e=this,i={},n=t.parents(".note-item"),a=n.find(".edit-area"),s=a.val();return i.id=n.attr("data-noteid"),""==$.trim(s)?(a.next(".error").html("笔记内容不能为空！"),!1):$.trim(s).length>2e3?(a.next(".error").html("笔记内容不能多余2000个字符！"),!1):(i.content=s,void $.post("/course/editnote",i,function(a){0==a.result?($.prompt("笔记修改成功！"),n.find(".content").html(i.content),e.editHide(t)):$.alert("修改失败")},"json"))},rmNote:function(t){var e=this,i=t.parents(".note-item"),n={};n.id=i.attr("data-noteid"),$.post("/course/deletenote",n,function(t){if(0==t.result){$.prompt("删除成功");var i=$(".js-notenav").find(".cur").data("type");e.refreshList(i)}else $.alert("删除失败")},"json")},favorNote:function(t){var e=t.parents(".note-item"),i=t.parents(".bottom-r"),n=i.find("span").html()-0,a={};a.id=e.attr("data-noteid"),a.option=1==e.attr("data-option")?0:1,$.post("/course/supportnote",a,function(s){0==s.result?1==a.option?(e.attr("data-option",1),i.find("span").html(n+1),t.attr("title","取消赞")):(e.attr("data-option",0),i.find("span").html(n-1),t.attr("title","赞")):$.prompt(s.msg,{icon:"error"})},"json")},collectNote:function(t){var e=t.parents(".note-item"),i=t.parents(".bottom-r"),n={};n.id=e.attr("data-noteid"),$.post("/course/collectnote",n,function(e){0==e.result?(i.find(".collect-num").html(i.find(".collect-num").html()-0+1),t.removeClass("collect js-collect").html("已采集")):$.prompt(e.msg,{icon:"error"})},"json")},refreshList:function(t){this.loadList(t)}},window.wendacmd=i,e});